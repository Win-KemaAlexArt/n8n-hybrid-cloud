{
  "name": "AWS Deployment Monitor",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "value": "0 */10 * * * *"
            }
          ]
        }
      },
      "id": "cron-aws-monitor",
      "name": "–ö–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç",
      "type": "n8n-nodes-base.cron",
      "typeVersion": 1,
      "position": [240, 300]
    },
    {
      "parameters": {
        "url": "http://169.254.169.254/latest/meta-data/instance-id",
        "options": {
          "timeout": 5000
        }
      },
      "id": "get-instance-metadata",
      "name": "–ü–æ–ª—É—á–∏—Ç—å –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ EC2",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [460, 300]
    },
    {
      "parameters": {
        "url": "http://169.254.169.254/latest/meta-data/instance-type",
        "options": {
          "timeout": 5000
        }
      },
      "id": "get-instance-type",
      "name": "–ü–æ–ª—É—á–∏—Ç—å –¢–∏–ø –ò–Ω—Å—Ç–∞–Ω—Å–∞",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [460, 400]
    },
    {
      "parameters": {
        "url": "http://169.254.169.254/latest/meta-data/placement/availability-zone",
        "options": {
          "timeout": 5000
        }
      },
      "id": "get-availability-zone",
      "name": "–ü–æ–ª—É—á–∏—Ç—å –ó–æ–Ω—É –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [460, 500]
    },
    {
      "parameters": {
        "jsCode": "// –°–±–æ—Ä —Å–∏—Å—Ç–µ–º–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏\nconst os = require('os');\nconst fs = require('fs');\n\n// –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–∏—Å—Ç–µ–º–µ\nconst cpus = os.cpus();\nconst totalMem = os.totalmem();\nconst freeMem = os.freemem();\nconst usedMem = totalMem - freeMem;\nconst memoryUsagePercent = (usedMem / totalMem) * 100;\n\n// –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –¥–∏—Å–∫–∞—Ö\nlet diskUsage = 0;\ntry {\n  const stats = fs.statSync('/');\n  diskUsage = 50; // –ü—Ä–∏–º–µ—Ä–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, —Ç–∞–∫ –∫–∞–∫ fs.statSync –Ω–µ –¥–∞–µ—Ç —Ç–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏\n} catch (error) {\n  diskUsage = 0;\n}\n\n// –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ CPU (–ø—Ä–∏–º–µ—Ä–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)\nconst loadAvg = os.loadavg();\nconst cpuUsage = Math.min((loadAvg[0] / cpus.length) * 100, 100);\n\nreturn [{\n  timestamp: new Date().toISOString(),\n  cpu_usage: Math.round(cpuUsage * 100) / 100,\n  memory_total_gb: Math.round((totalMem / (1024 * 1024 * 1024)) * 100) / 100,\n  memory_used_gb: Math.round((usedMem / (1024 * 1024 * 1024)) * 100) / 100,\n  memory_usage_percent: Math.round(memoryUsagePercent * 100) / 100,\n  disk_usage_percent: diskUsage,\n  load_average_1min: Math.round(loadAvg[0] * 100) / 100,\n  load_average_5min: Math.round(loadAvg[1] * 100) / 100,\n  load_average_15min: Math.round(loadAvg[2] * 100) / 100,\n  cpu_count: cpus.length,\n  uptime_hours: Math.round((os.uptime() / 3600) * 100) / 100\n}];"
      },
      "id": "collect-system-info",
      "name": "–°–æ–±—Ä–∞—Ç—å –°–∏—Å—Ç–µ–º–Ω—É—é –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [460, 600]
    },
    {
      "parameters": {
        "jsCode": "// –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö AWS\nconst instanceId = $('–ü–æ–ª—É—á–∏—Ç—å –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ EC2').first().json.body;\nconst instanceType = $('–ü–æ–ª—É—á–∏—Ç—å –¢–∏–ø –ò–Ω—Å—Ç–∞–Ω—Å–∞').first().json.body;\nconst availabilityZone = $('–ü–æ–ª—É—á–∏—Ç—å –ó–æ–Ω—É –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏').first().json.body;\nconst systemInfo = $('–°–æ–±—Ä–∞—Ç—å –°–∏—Å—Ç–µ–º–Ω—É—é –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é').first().json;\n\nreturn [{\n  timestamp: new Date().toISOString(),\n  instance_id: instanceId,\n  instance_type: instanceType,\n  availability_zone: availabilityZone,\n  cpu_usage: systemInfo.cpu_usage,\n  memory_total_gb: systemInfo.memory_total_gb,\n  memory_used_gb: systemInfo.memory_used_gb,\n  memory_usage_percent: systemInfo.memory_usage_percent,\n  disk_usage_percent: systemInfo.disk_usage_percent,\n  load_average_1min: systemInfo.load_average_1min,\n  load_average_5min: systemInfo.load_average_5min,\n  load_average_15min: systemInfo.load_average_15min,\n  cpu_count: systemInfo.cpu_count,\n  uptime_hours: systemInfo.uptime_hours,\n  region: availabilityZone ? availabilityZone.slice(0, -1) : 'unknown',\n  status: 'healthy'\n}];"
      },
      "id": "merge-aws-data",
      "name": "–û–±—ä–µ–¥–∏–Ω–∏—Ç—å –î–∞–Ω–Ω—ã–µ AWS",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [680, 450]
    },
    {
      "parameters": {
        "table": "aws_metrics",
        "operation": "insert",
        "records": {
          "values": {
            "timestamp": "={{$json.timestamp}}",
            "instance_id": "={{$json.instance_id}}",
            "instance_type": "={{$json.instance_type}}",
            "availability_zone": "={{$json.availability_zone}}",
            "cpu_utilization": "={{$json.cpu_usage}}",
            "memory_utilization": "={{$json.memory_usage_percent}}",
            "disk_read_ops": 0,
            "disk_write_ops": 0,
            "network_packets_in": 0,
            "network_packets_out": 0,
            "status_check_failed": 0,
            "metadata": "={{JSON.stringify($json)}}"
          }
        }
      },
      "id": "insert-aws-metrics",
      "name": "–í—Å—Ç–∞–≤–∏—Ç—å AWS –ú–µ—Ç—Ä–∏–∫–∏",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [900, 300],
      "credentials": {
        "supabaseApi": {
          "id": "supabase-credentials",
          "name": "Supabase API"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ N8N\nconst timestamp = new Date().toISOString();\n\n// –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π (–ø—Ä–∏–º–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)\nconst totalExecutions = Math.floor(Math.random() * 50) + 10;\nconst successfulExecutions = Math.floor(totalExecutions * (0.85 + Math.random() * 0.1));\nconst failedExecutions = totalExecutions - successfulExecutions;\nconst runningExecutions = Math.floor(Math.random() * 5);\n\nconst avgExecutionTime = 2000 + Math.random() * 3000; // 2-5 —Å–µ–∫—É–Ω–¥\nconst uniqueWorkflows = Math.floor(Math.random() * 10) + 3;\nconst errorRate = (failedExecutions / totalExecutions) * 100;\nconst throughputPerMinute = totalExecutions / 10; // –∑–∞ 10 –º–∏–Ω—É—Ç\n\n// –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–¥–æ—Ä–æ–≤—å—è –∏–Ω—Å—Ç–∞–Ω—Å–∞\nconst awsData = $('–û–±—ä–µ–¥–∏–Ω–∏—Ç—å –î–∞–Ω–Ω—ã–µ AWS').first().json;\nlet instanceHealth = 'healthy';\nif (awsData.cpu_usage > 80 || awsData.memory_usage_percent > 85) {\n  instanceHealth = 'warning';\n}\nif (awsData.cpu_usage > 90 || awsData.memory_usage_percent > 95 || errorRate > 20) {\n  instanceHealth = 'critical';\n}\n\nreturn [{\n  timestamp: timestamp,\n  total_executions_10min: totalExecutions,\n  successful_executions: successfulExecutions,\n  failed_executions: failedExecutions,\n  running_executions: runningExecutions,\n  avg_execution_time: Math.round(avgExecutionTime),\n  unique_workflows: uniqueWorkflows,\n  error_rate: Math.round(errorRate * 100) / 100,\n  throughput_per_minute: Math.round(throughputPerMinute * 100) / 100,\n  instance_health: instanceHealth,\n  cpu_usage: awsData.cpu_usage,\n  memory_usage_percent: awsData.memory_usage_percent\n}];"
      },
      "id": "analyze-n8n-performance",
      "name": "–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å N8N",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [900, 600]
    },
    {
      "parameters": {
        "table": "n8n_performance",
        "operation": "insert",
        "records": {
          "values": {
            "timestamp": "={{$json.timestamp}}",
            "active_executions": "={{$json.total_executions_10min}}",
            "waiting_executions": "={{$json.running_executions}}",
            "queue_length": 0,
            "memory_heap_used": 0,
            "memory_heap_total": 0,
            "uptime_seconds": 0,
            "version": "1.0.0",
            "node_count": 0,
            "webhook_count": 0,
            "database_connections": 0,
            "response_time_ms": "={{$json.avg_execution_time}}",
            "error_count": "={{$json.failed_executions}}",
            "metadata": "={{JSON.stringify($json)}}"
          }
        }
      },
      "id": "insert-n8n-performance",
      "name": "–í—Å—Ç–∞–≤–∏—Ç—å –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å N8N",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [1120, 600],
      "credentials": {
        "supabaseApi": {
          "id": "supabase-credentials",
          "name": "Supabase API"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{$json.cpu_usage}}",
              "operation": "larger",
              "value2": 80
            }
          ]
        }
      },
      "id": "check-high-cpu",
      "name": "–í—ã—Å–æ–∫–∞—è –ù–∞–≥—Ä—É–∑–∫–∞ CPU?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [1340, 300]
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{$json.memory_usage_percent}}",
              "operation": "larger",
              "value2": 85
            }
          ]
        }
      },
      "id": "check-high-memory",
      "name": "–í—ã—Å–æ–∫–æ–µ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ü–∞–º—è—Ç–∏?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [1340, 400]
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{$json.error_rate}}",
              "operation": "larger",
              "value2": 10
            }
          ]
        }
      },
      "id": "check-high-error-rate",
      "name": "–í—ã—Å–æ–∫–∏–π –ü—Ä–æ—Ü–µ–Ω—Ç –û—à–∏–±–æ–∫?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [1340, 600]
    },
    {
      "parameters": {
        "chatId": "-1001234567890",
        "text": "üö® **AWS ALERT - –í–´–°–û–ö–ê–Ø –ù–ê–ì–†–£–ó–ö–ê**\\n\\nüñ•Ô∏è **–ò–Ω—Å—Ç–∞–Ω—Å:** {{$('–û–±—ä–µ–¥–∏–Ω–∏—Ç—å –î–∞–Ω–Ω—ã–µ AWS').first().json.instance_id}}\\nüìç **–ó–æ–Ω–∞:** {{$('–û–±—ä–µ–¥–∏–Ω–∏—Ç—å –î–∞–Ω–Ω—ã–µ AWS').first().json.availability_zone}}\\n\\n‚ö†Ô∏è **–ü—Ä–æ–±–ª–µ–º—ã:**\\n{{#if $('–í—ã—Å–æ–∫–∞—è –ù–∞–≥—Ä—É–∑–∫–∞ CPU?').first()}}üî• CPU: {{$('–û–±—ä–µ–¥–∏–Ω–∏—Ç—å –î–∞–Ω–Ω—ã–µ AWS').first().json.cpu_usage}}%\\n{{/if}}{{#if $('–í—ã—Å–æ–∫–æ–µ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ü–∞–º—è—Ç–∏?').first()}}üíæ –ü–∞–º—è—Ç—å: {{$('–û–±—ä–µ–¥–∏–Ω–∏—Ç—å –î–∞–Ω–Ω—ã–µ AWS').first().json.memory_usage_percent}}%\\n{{/if}}{{#if $('–í—ã—Å–æ–∫–∏–π –ü—Ä–æ—Ü–µ–Ω—Ç –û—à–∏–±–æ–∫?').first()}}‚ùå –û—à–∏–±–∫–∏ N8N: {{$('–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å N8N').first().json.error_rate}}%\\n{{/if}}\\nüïê **–í—Ä–µ–º—è:** {{new Date().toLocaleString('ru-RU')}}\\n\\nüîß –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏—Å—Ç–µ–º—É!",
        "additionalFields": {
          "parse_mode": "Markdown"
        }
      },
      "id": "send-aws-alert",
      "name": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å AWS Alert",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [1560, 450],
      "credentials": {
        "telegramApi": {
          "id": "telegram-bot-credentials",
          "name": "Telegram Bot API"
        }
      }
    }
  ],
  "connections": {
    "–ö–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç": {
      "main": [
        [
          {
            "node": "–ü–æ–ª—É—á–∏—Ç—å –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ EC2",
            "type": "main",
            "index": 0
          },
          {
            "node": "–ü–æ–ª—É—á–∏—Ç—å –¢–∏–ø –ò–Ω—Å—Ç–∞–Ω—Å–∞",
            "type": "main",
            "index": 0
          },
          {
            "node": "–ü–æ–ª—É—á–∏—Ç—å –ó–æ–Ω—É –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏",
            "type": "main",
            "index": 0
          },
          {
            "node": "–°–æ–±—Ä–∞—Ç—å –°–∏—Å—Ç–µ–º–Ω—É—é –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü–æ–ª—É—á–∏—Ç—å –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ EC2": {
      "main": [
        [
          {
            "node": "–û–±—ä–µ–¥–∏–Ω–∏—Ç—å –î–∞–Ω–Ω—ã–µ AWS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü–æ–ª—É—á–∏—Ç—å –¢–∏–ø –ò–Ω—Å—Ç–∞–Ω—Å–∞": {
      "main": [
        [
          {
            "node": "–û–±—ä–µ–¥–∏–Ω–∏—Ç—å –î–∞–Ω–Ω—ã–µ AWS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü–æ–ª—É—á–∏—Ç—å –ó–æ–Ω—É –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏": {
      "main": [
        [
          {
            "node": "–û–±—ä–µ–¥–∏–Ω–∏—Ç—å –î–∞–Ω–Ω—ã–µ AWS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–°–æ–±—Ä–∞—Ç—å –°–∏—Å—Ç–µ–º–Ω—É—é –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é": {
      "main": [
        [
          {
            "node": "–û–±—ä–µ–¥–∏–Ω–∏—Ç—å –î–∞–Ω–Ω—ã–µ AWS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–û–±—ä–µ–¥–∏–Ω–∏—Ç—å –î–∞–Ω–Ω—ã–µ AWS": {
      "main": [
        [
          {
            "node": "–í—Å—Ç–∞–≤–∏—Ç—å AWS –ú–µ—Ç—Ä–∏–∫–∏",
            "type": "main",
            "index": 0
          },
          {
            "node": "–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å N8N",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å N8N": {
      "main": [
        [
          {
            "node": "–í—Å—Ç–∞–≤–∏—Ç—å –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å N8N",
            "type": "main",
            "index": 0
          },
          {
            "node": "–í—ã—Å–æ–∫–∞—è –ù–∞–≥—Ä—É–∑–∫–∞ CPU?",
            "type": "main",
            "index": 0
          },
          {
            "node": "–í—ã—Å–æ–∫–æ–µ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ü–∞–º—è—Ç–∏?",
            "type": "main",
            "index": 0
          },
          {
            "node": "–í—ã—Å–æ–∫–∏–π –ü—Ä–æ—Ü–µ–Ω—Ç –û—à–∏–±–æ–∫?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–í—ã—Å–æ–∫–∞—è –ù–∞–≥—Ä—É–∑–∫–∞ CPU?": {
      "main": [
        [
          {
            "node": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å AWS Alert",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–í—ã—Å–æ–∫–æ–µ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ü–∞–º—è—Ç–∏?": {
      "main": [
        [
          {
            "node": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å AWS Alert",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–í—ã—Å–æ–∫–∏–π –ü—Ä–æ—Ü–µ–Ω—Ç –û—à–∏–±–æ–∫?": {
      "main": [
        [
          {
            "node": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å AWS Alert",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-01-07T00:21:23.000Z",
  "versionId": "1"
}
